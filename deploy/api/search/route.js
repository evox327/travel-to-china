"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79380:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var i={};r.r(i),r.d(i,{GET:()=>p});var n=r(49303),a=r(88716),o=r(60670),s=r(87070),u=r(2021),c=r(90149),l=r(43863);async function p(e){try{await (0,u.Z)();let{searchParams:t}=new URL(e.url),r=t.get("q"),i=t.get("type")||"all",n=parseInt(t.get("limit")||"10");if(!r)return s.NextResponse.json({error:"Search query is required"},{status:400});let a=RegExp(r,"i"),o={attractions:[],guides:[],total:0};if("all"===i||"attractions"===i){let e=await c.Z.find({isActive:!0,$or:[{"name.en":a},{"name.zh":a},{"description.en":a},{"description.zh":a},{"location.city":a},{"location.province":a},{highlights:{$in:[a]}}]}).limit("attractions"===i?n:Math.floor(n/2)).select("name description location images category rating reviewCount").lean();o.attractions=e.map(e=>({...e,type:"attraction"}))}if("all"===i||"guides"===i){let e=await l.Z.find({isPublished:!0,$or:[{"title.en":a},{"title.zh":a},{"excerpt.en":a},{"excerpt.zh":a},{"content.en":a},{"content.zh":a},{tags:{$in:[a]}}]}).populate("author","name image").limit("guides"===i?n:Math.floor(n/2)).select("title excerpt coverImage category tags readTime views likes publishedAt author").lean();o.guides=e.map(e=>({...e,type:"guide"}))}o.total=o.attractions.length+o.guides.length;let p=await d(r);return s.NextResponse.json({results:o,suggestions:p,query:r})}catch(e){return console.error("Search error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e){try{let t=[];return(await c.Z.find({isActive:!0,"name.en":{$regex:e,$options:"i"}}).limit(5).select("name").lean()).forEach(e=>{t.push({text:e.name.en,type:"attraction"})}),(await c.Z.aggregate([{$match:{isActive:!0,"location.city":{$regex:e,$options:"i"}}},{$group:{_id:"$location.city",count:{$sum:1}}},{$sort:{count:-1}},{$limit:3}])).forEach(e=>{t.push({text:e._id,type:"city"})}),(await l.Z.aggregate([{$match:{isPublished:!0,category:{$regex:e,$options:"i"}}},{$group:{_id:"$category",count:{$sum:1}}},{$sort:{count:-1}},{$limit:2}])).forEach(e=>{t.push({text:e._id.replace("-"," "),type:"category"})}),t.slice(0,10)}catch(e){return console.error("Error generating suggestions:",e),[]}}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"/Users/luxiang/Cursor/AI-project/travel-to-china/app/api/search/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:h}=g,f="/api/search/route";function S(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},2021:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),n=r.n(i);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let s=async function(){if(o.conn)return o.conn;o.promise||(o.promise=n().connect(a,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},90149:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),n=r.n(i);let a=new i.Schema({name:{type:Map,of:String,required:!0},description:{type:Map,of:String,required:!0},location:{city:{type:String,required:!0},province:{type:String,required:!0},coordinates:{lat:{type:Number,required:!0},lng:{type:Number,required:!0}}},images:[{type:String,required:!0}],category:{type:String,enum:["historical","natural","cultural","modern","religious"],required:!0},rating:{type:Number,min:0,max:5,default:0},reviewCount:{type:Number,default:0},highlights:[String],ticketPrice:{adult:{type:Number,required:!0},child:{type:Number,required:!0},currency:{type:String,default:"CNY"}},duration:{type:String,required:!0},bestTimeToVisit:[String],openingHours:{open:{type:String,required:!0},close:{type:String,required:!0},note:String},contact:{phone:String,website:String,email:String},isActive:{type:Boolean,default:!0}},{timestamps:!0});a.index({"location.city":1}),a.index({category:1}),a.index({rating:-1}),a.index({"location.coordinates":"2dsphere"});let o=n().models.Attraction||n().model("Attraction",a)},43863:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),n=r.n(i);let a=new i.Schema({title:{type:Map,of:String,required:!0},content:{type:Map,of:String,required:!0},excerpt:{type:Map,of:String,required:!0},author:{type:i.Schema.Types.ObjectId,ref:"User",required:!0},category:{type:String,enum:["first-time","food-culture","adventure","multi-city","budget","luxury"],required:!0},tags:[String],coverImage:{type:String,required:!0},images:[String],readTime:{type:Number,required:!0},views:{type:Number,default:0},likes:{type:Number,default:0},isPublished:{type:Boolean,default:!1},publishedAt:Date,itinerary:[{day:{type:Number,required:!0},title:{type:String,required:!0},description:{type:String,required:!0},activities:[String],accommodation:String,transportation:String,estimatedCost:Number}],relatedAttractions:[{type:i.Schema.Types.ObjectId,ref:"Attraction"}],seo:{metaTitle:String,metaDescription:String,keywords:[String]}},{timestamps:!0});a.index({category:1}),a.index({isPublished:1}),a.index({publishedAt:-1}),a.index({views:-1}),a.index({tags:1});let o=n().models.Guide||n().model("Guide",a)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,972],()=>r(79380));module.exports=i})();