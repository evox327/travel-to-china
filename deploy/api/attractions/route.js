"use strict";(()=>{var e={};e.id=949,e.ids=[949],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},16926:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>p});var i=r(49303),n=r(88716),o=r(60670),s=r(87070),c=r(2021),l=r(90149),h=r(46643);async function u(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),a=parseInt(t.get("limit")||"12"),i=t.get("category"),n=t.get("city"),o=t.get("search"),u=t.get("sort")||"rating",p=h.kx.generateKey("attractions",r.toString(),a.toString(),i||"all",n||"all",o||"none",u),g=await h.I5.get(p);if(g)return s.NextResponse.json(g);await (0,c.Z)();let m={isActive:!0};i&&(m.category=i),n&&(m["location.city"]={$regex:n,$options:"i"}),o&&(m.$or=[{"name.en":{$regex:o,$options:"i"}},{"name.zh":{$regex:o,$options:"i"}},{"description.en":{$regex:o,$options:"i"}},{"description.zh":{$regex:o,$options:"i"}}]);let d={};switch(u){case"rating":default:d={rating:-1};break;case"name":d={"name.en":1};break;case"newest":d={createdAt:-1}}let y=(r-1)*a,[x,S]=await Promise.all([l.Z.find(m).sort(d).skip(y).limit(a).lean(),l.Z.countDocuments(m)]),f={attractions:x,pagination:{page:r,limit:a,total:S,pages:Math.ceil(S/a)}};return await h.I5.set(p,f,3e5),s.NextResponse.json(f)}catch(e){return console.error("Error fetching attractions:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let t=await e.json();await (0,c.Z)();let r=await l.Z.create(t);return s.NextResponse.json(r,{status:201})}catch(e){return console.error("Error creating attraction:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/attractions/route",pathname:"/api/attractions",filename:"route",bundlePath:"app/api/attractions/route"},resolvedPagePath:"/Users/luxiang/Cursor/AI-project/travel-to-china/app/api/attractions/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:y}=g,x="/api/attractions/route";function S(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:d})}},46643:(e,t,r)=>{r.d(t,{I5:()=>o,kx:()=>s});class a{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||100,this.defaultTTL=e.ttl||3e5}set(e,t,r){let a=Date.now()+(r||this.defaultTTL);if(this.cache.size>=this.maxSize){let e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(e,{data:t,timestamp:Date.now(),expiry:a})}get(e){let t=this.cache.get(e);return t?Date.now()>t.expiry?(this.cache.delete(e),null):t.data:null}has(e){let t=this.cache.get(e);return!!t&&(!(Date.now()>t.expiry)||(this.cache.delete(e),!1))}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}size(){return this.cleanExpired(),this.cache.size}cleanExpired(){let e=Date.now(),t=[];this.cache.forEach((r,a)=>{e>r.expiry&&t.push(a)}),t.forEach(e=>this.cache.delete(e))}getStats(){return this.cleanExpired(),{size:this.cache.size,maxSize:this.maxSize,hitRate:0}}}class i{constructor(e="app_cache_",t=18e5){this.prefix=e,this.defaultTTL=t}set(e,t,r){try{let a=Date.now()+(r||this.defaultTTL),i={data:t,timestamp:Date.now(),expiry:a};localStorage.setItem(this.prefix+e,JSON.stringify(i))}catch(e){console.warn("Failed to set localStorage cache:",e)}}get(e){try{let t=localStorage.getItem(this.prefix+e);if(!t)return null;let r=JSON.parse(t);if(Date.now()>r.expiry)return localStorage.removeItem(this.prefix+e),null;return r.data}catch(e){return console.warn("Failed to get localStorage cache:",e),null}}has(e){return null!==this.get(e)}delete(e){try{return localStorage.removeItem(this.prefix+e),!0}catch(e){return console.warn("Failed to delete localStorage cache:",e),!1}}clear(){try{Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>localStorage.removeItem(e))}catch(e){console.warn("Failed to clear localStorage cache:",e)}}cleanup(){try{Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>{let t=localStorage.getItem(e);if(t)try{let r=JSON.parse(t);Date.now()>r.expiry&&localStorage.removeItem(e)}catch{localStorage.removeItem(e)}})}catch(e){console.warn("Failed to cleanup localStorage cache:",e)}}}class n{constructor(e={}){this.memoryCache=new a({maxSize:e.maxSize||50,ttl:e.ttl||3e5}),this.storageCache=new i("travel_cache_",e.ttl||18e5)}async get(e){let t=this.memoryCache.get(e);return t||((t=this.storageCache.get(e))?(this.memoryCache.set(e,t,3e5),t):null)}async set(e,t,r){this.memoryCache.set(e,t,Math.min(r||3e5,3e5)),this.storageCache.set(e,t,r||18e5)}async has(e){return this.memoryCache.has(e)||this.storageCache.has(e)}async delete(e){let t=this.memoryCache.delete(e),r=this.storageCache.delete(e);return t||r}async clear(){this.memoryCache.clear(),this.storageCache.clear()}cleanup(){this.storageCache.cleanup()}getStats(){return{memory:this.memoryCache.getStats(),storage:{size:0,hitRate:0}}}}let o=function(e="multi",t={}){switch(e){case"memory":return new a(t);case"storage":return new i("travel_cache_",t.ttl);default:return new n(t)}}("multi",{ttl:6e5,maxSize:100}),s={generateKey:(...e)=>e.map(e=>String(e)).join(":"),withCache:(e,t,r)=>async(...a)=>{let i=t(...a),n=await o.get(i);if(null!==n)return n;let s=await e(...a);return await o.set(i,s,r),s}}},2021:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),i=r.n(a);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let s=async function(){if(o.conn)return o.conn;o.promise||(o.promise=i().connect(n,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},90149:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),i=r.n(a);let n=new a.Schema({name:{type:Map,of:String,required:!0},description:{type:Map,of:String,required:!0},location:{city:{type:String,required:!0},province:{type:String,required:!0},coordinates:{lat:{type:Number,required:!0},lng:{type:Number,required:!0}}},images:[{type:String,required:!0}],category:{type:String,enum:["historical","natural","cultural","modern","religious"],required:!0},rating:{type:Number,min:0,max:5,default:0},reviewCount:{type:Number,default:0},highlights:[String],ticketPrice:{adult:{type:Number,required:!0},child:{type:Number,required:!0},currency:{type:String,default:"CNY"}},duration:{type:String,required:!0},bestTimeToVisit:[String],openingHours:{open:{type:String,required:!0},close:{type:String,required:!0},note:String},contact:{phone:String,website:String,email:String},isActive:{type:Boolean,default:!0}},{timestamps:!0});n.index({"location.city":1}),n.index({category:1}),n.index({rating:-1}),n.index({"location.coordinates":"2dsphere"});let o=i().models.Attraction||i().model("Attraction",n)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(16926));module.exports=a})();