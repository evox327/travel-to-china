(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{617:function(e,t,a){Promise.resolve().then(a.bind(a,3346))},3346:function(e,t,a){"use strict";let s,n;a.r(t),a.d(t,{default:function(){return N}});var l=a(7437),r=a(605),i=a(2265),c=a(9376);class o{set(e,t,a){let s=Date.now()+(a||this.defaultTTL);if(this.cache.size>=this.maxSize){let e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(e,{data:t,timestamp:Date.now(),expiry:s})}get(e){let t=this.cache.get(e);return t?Date.now()>t.expiry?(this.cache.delete(e),null):t.data:null}has(e){let t=this.cache.get(e);return!!t&&(!(Date.now()>t.expiry)||(this.cache.delete(e),!1))}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}size(){return this.cleanExpired(),this.cache.size}cleanExpired(){let e=Date.now(),t=[];this.cache.forEach((a,s)=>{e>a.expiry&&t.push(s)}),t.forEach(e=>this.cache.delete(e))}getStats(){return this.cleanExpired(),{size:this.cache.size,maxSize:this.maxSize,hitRate:0}}constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||100,this.defaultTTL=e.ttl||3e5}}class d{set(e,t,a){try{let s=Date.now()+(a||this.defaultTTL),n={data:t,timestamp:Date.now(),expiry:s};localStorage.setItem(this.prefix+e,JSON.stringify(n))}catch(e){console.warn("Failed to set localStorage cache:",e)}}get(e){try{let t=localStorage.getItem(this.prefix+e);if(!t)return null;let a=JSON.parse(t);if(Date.now()>a.expiry)return localStorage.removeItem(this.prefix+e),null;return a.data}catch(e){return console.warn("Failed to get localStorage cache:",e),null}}has(e){return null!==this.get(e)}delete(e){try{return localStorage.removeItem(this.prefix+e),!0}catch(e){return console.warn("Failed to delete localStorage cache:",e),!1}}clear(){try{Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>localStorage.removeItem(e))}catch(e){console.warn("Failed to clear localStorage cache:",e)}}cleanup(){try{Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>{let t=localStorage.getItem(e);if(t)try{let a=JSON.parse(t);Date.now()>a.expiry&&localStorage.removeItem(e)}catch(t){localStorage.removeItem(e)}})}catch(e){console.warn("Failed to cleanup localStorage cache:",e)}}constructor(e="app_cache_",t=18e5){this.prefix=e,this.defaultTTL=t}}class h{async get(e){let t=this.memoryCache.get(e);return t||((t=this.storageCache.get(e))?(this.memoryCache.set(e,t,3e5),t):null)}async set(e,t,a){this.memoryCache.set(e,t,Math.min(a||3e5,3e5)),this.storageCache.set(e,t,a||18e5)}async has(e){return this.memoryCache.has(e)||this.storageCache.has(e)}async delete(e){let t=this.memoryCache.delete(e),a=this.storageCache.delete(e);return t||a}async clear(){this.memoryCache.clear(),this.storageCache.clear()}cleanup(){this.storageCache.cleanup()}getStats(){return{memory:this.memoryCache.getStats(),storage:{size:0,hitRate:0}}}constructor(e={}){this.memoryCache=new o({maxSize:e.maxSize||50,ttl:e.ttl||3e5}),this.storageCache=new d("travel_cache_",e.ttl||18e5)}}let m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multi",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){case"memory":return new o(t);case"storage":return new d("travel_cache_",t.ttl);default:return new h(t)}}("multi",{ttl:6e5,maxSize:100}),u=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.map(e=>String(e)).join(":")},x={sunny:{zh:"晴天",icon:"☀️",color:"text-yellow-500"},cloudy:{zh:"多云",icon:"☁️",color:"text-gray-500"},overcast:{zh:"阴天",icon:"☁️",color:"text-gray-600"},"light-rain":{zh:"小雨",icon:"\uD83C\uDF26️",color:"text-blue-500"},"moderate-rain":{zh:"中雨",icon:"\uD83C\uDF27️",color:"text-blue-600"},"heavy-rain":{zh:"大雨",icon:"⛈️",color:"text-blue-800"},thunderstorm:{zh:"雷阵雨",icon:"⛈️",color:"text-purple-600"},snow:{zh:"雪",icon:"❄️",color:"text-blue-300"},fog:{zh:"雾",icon:"\uD83C\uDF2B️",color:"text-gray-400"},haze:{zh:"霾",icon:"\uD83D\uDE36‍\uD83C\uDF2B️",color:"text-yellow-600"},sandstorm:{zh:"沙尘暴",icon:"\uD83C\uDF2A️",color:"text-yellow-800"}},g={N:"北风",NE:"东北风",E:"东风",SE:"东南风",S:"南风",SW:"西南风",W:"西风",NW:"西北风"};function f(e){let t=["sunny","cloudy","light-rain","overcast"],a=t[Math.floor(Math.random()*t.length)];return{temperature:Math.floor(30*Math.random())+5,condition:x[a].zh,conditionCode:a,humidity:Math.floor(40*Math.random())+40,windSpeed:Math.floor(15*Math.random())+5,windDirection:"东南风",visibility:Math.floor(20*Math.random())+10,pressure:Math.floor(50*Math.random())+1e3,uvIndex:Math.floor(11*Math.random()),feelLike:Math.floor(30*Math.random())+5,city:e,updateTime:new Date().toISOString(),forecast:function(){let e=[],t=["sunny","cloudy","light-rain","overcast"];for(let a=0;a<7;a++){let s=new Date;s.setDate(s.getDate()+a);let n=t[Math.floor(Math.random()*t.length)];e.push({date:s.toISOString().split("T")[0],dayOfWeek:y(s.toISOString().split("T")[0]),high:Math.floor(15*Math.random())+20,low:Math.floor(15*Math.random())+5,condition:x[n].zh,conditionCode:n,rainfall:10*Math.random(),windSpeed:Math.floor(15*Math.random())+5})}return e}()}}function p(e){let t=e.toLowerCase();for(let[e,a]of Object.entries(x))if(t.includes(e.replace("-"," ")))return a.zh;return e}function y(e){return["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][new Date(e).getDay()]}let b=(s=async function(e,t){try{var a;let s="demo-key",n=e;t&&(n="".concat(t.lng,",").concat(t.lat));let l=await fetch("https://devapi.qweather.com/v7/weather/now?location=".concat(encodeURIComponent(n),"&key=").concat(s,"&lang=zh")),r=await fetch("https://devapi.qweather.com/v7/weather/7d?location=".concat(encodeURIComponent(n),"&key=").concat(s,"&lang=zh"));if(!l.ok||!r.ok)return console.error("天气API请求失败"),f(e);let i=await l.json(),c=await r.json();if("200"!==i.code||"200"!==c.code)return console.error("天气API返回错误代码"),f(e);let o=i.now,d=c.daily;return{temperature:parseInt(o.temp),condition:p(o.text),conditionCode:o.icon,humidity:parseInt(o.humidity),windSpeed:parseInt(o.windSpeed),windDirection:g[a=o.windDir]||a,visibility:parseInt(o.vis),pressure:parseInt(o.pressure),uvIndex:parseInt(o.uv||"0"),feelLike:parseInt(o.feelsLike),city:e,updateTime:o.obsTime,forecast:d.slice(0,7).map(e=>({date:e.fxDate,dayOfWeek:y(e.fxDate),high:parseInt(e.tempMax),low:parseInt(e.tempMin),condition:p(e.textDay),conditionCode:e.iconDay,rainfall:parseFloat(e.precip||"0"),windSpeed:parseInt(e.windSpeedDay)}))}}catch(t){return console.error("获取天气数据失败:",t),f(e)}},n=(e,t)=>u("weather",t?"".concat(t.lat,",").concat(t.lng):e),async function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let l=n(...t),r=await m.get(l);if(null!==r)return r;let i=await s(...t);return await m.set(l,i,6e5),i});async function j(e){let t=e.map(async e=>{try{await b(e)}catch(t){console.warn("Failed to preload weather for ".concat(e,":"),t)}});await Promise.allSettled(t)}function v(e){let{city:t="Beijing",className:a=""}=e,[s,n]=(0,i.useState)(null),[r,c]=(0,i.useState)(!0),[o,d]=(0,i.useState)(null);return((0,i.useEffect)(()=>{(async function(){try{c(!0),d(null);let e=await b(t);n(e)}catch(e){d(e instanceof Error?e.message:"获取天气信息失败")}finally{c(!1)}})()},[t]),r)?(0,l.jsx)("div",{className:"bg-blue-50 rounded-lg p-4 ".concat(a),children:(0,l.jsxs)("div",{className:"animate-pulse",children:[(0,l.jsx)("div",{className:"h-4 bg-blue-200 rounded w-1/2 mb-2"}),(0,l.jsx)("div",{className:"h-6 bg-blue-200 rounded w-1/3"})]})}):o?(0,l.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 ".concat(a),children:(0,l.jsx)("p",{className:"text-red-600 text-sm",children:o})}):s?(0,l.jsx)("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-lg p-4 ".concat(a),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold text-lg",children:s.city}),(0,l.jsxs)("p",{className:"text-2xl font-bold",children:[s.temperature,"\xb0C"]}),(0,l.jsx)("p",{className:"text-blue-100",children:s.condition})]}),(0,l.jsxs)("div",{className:"text-right text-sm",children:[(0,l.jsxs)("p",{className:"text-blue-100",children:["湿度: ",s.humidity,"%"]}),(0,l.jsxs)("p",{className:"text-blue-100",children:["风速: ",s.windSpeed," km/h"]})]})]})}):null}function w(){let[e,t]=(0,i.useState)(null),[a,s]=(0,i.useState)(!1),n=()=>{t(m.getStats())};(0,i.useEffect)(()=>{n();let e=setInterval(n,3e4);return()=>clearInterval(e)},[]);let r=async()=>{s(!0);try{await m.clear(),n()}catch(e){console.error("Failed to clear cache:",e)}finally{s(!1)}},c=async()=>{s(!0);try{await j(["Beijing","Shanghai","Guangzhou","Shenzhen","Hangzhou"]),n()}catch(e){console.error("Failed to preload weather data:",e)}finally{s(!1)}};return e?(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"缓存管理"}),(0,l.jsx)("button",{onClick:n,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"刷新"})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"内存缓存"}),(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"缓存项数:"}),(0,l.jsxs)("span",{className:"font-medium",children:[e.memory.size," / ",e.memory.maxSize]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"使用率:"}),(0,l.jsxs)("span",{className:"font-medium",children:[(e.memory.size/e.memory.maxSize*100).toFixed(1),"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(e.memory.size/e.memory.maxSize*100,"%")}})})]})]}),(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"本地存储"}),(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"状态:"}),(0,l.jsx)("span",{className:"font-medium text-green-600",children:"活跃"})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"自动清理:"}),(0,l.jsx)("span",{className:"font-medium text-blue-600",children:"启用"})]})]})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900",children:"缓存操作"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,l.jsx)("button",{onClick:()=>{s(!0);try{m.cleanup(),n()}catch(e){console.error("Failed to cleanup cache:",e)}finally{s(!1)}},disabled:a,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"处理中...":"清理过期缓存"}),(0,l.jsx)("button",{onClick:c,disabled:a,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"预加载中...":"预加载天气"}),(0,l.jsx)("button",{onClick:r,disabled:a,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"清理中...":"清空所有缓存"})]})]}),(0,l.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"缓存策略说明"}),(0,l.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,l.jsx)("li",{children:"• 天气数据缓存 10 分钟，减少 API 调用"}),(0,l.jsx)("li",{children:"• 景点数据缓存 5 分钟，提升浏览体验"}),(0,l.jsx)("li",{children:"• 内存缓存优先，本地存储作为备份"}),(0,l.jsx)("li",{children:"• 自动清理过期数据，优化存储空间"})]})]})]}):(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,l.jsxs)("div",{className:"animate-pulse",children:[(0,l.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded"}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]})})}function N(){let{data:e,status:t}=(0,r.useSession)(),a=(0,c.useRouter)(),[s,n]=(0,i.useState)(null),[o,d]=(0,i.useState)(!0),[h,m]=(0,i.useState)(!1),[u,x]=(0,i.useState)({name:"",language:"zh",notifications:!0,location:"Beijing"});(0,i.useEffect)(()=>{if("unauthenticated"===t){a.push("/auth/signin");return}if(null==e?void 0:e.user){let t={name:e.user.name||"",email:e.user.email||"",favoriteAttractions:["故宫","天安门广场","长城"],visitHistory:["北京","上海","西安"],preferences:{language:"zh",notifications:!0,location:"Beijing"}};n(t),x({name:t.name,language:t.preferences.language,notifications:t.preferences.notifications,location:t.preferences.location}),d(!1)}},[e,t,a]);let g=async()=>{s&&(n({...s,name:u.name,preferences:{...s.preferences,language:u.language,notifications:u.notifications,location:u.location}}),m(!1))};return o?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):s?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"个人中心"}),(0,l.jsx)("button",{onClick:()=>m(!h),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:h?"取消":"编辑"})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"基本信息"}),h?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"姓名"}),(0,l.jsx)("input",{type:"text",value:u.name,onChange:e=>x({...u,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"语言偏好"}),(0,l.jsxs)("select",{value:u.language,onChange:e=>x({...u,language:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"zh",children:"中文"}),(0,l.jsx)("option",{value:"en",children:"English"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"所在城市"}),(0,l.jsx)("input",{type:"text",value:u.location,onChange:e=>x({...u,location:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"notifications",checked:u.notifications,onChange:e=>x({...u,notifications:e.target.checked}),className:"mr-2"}),(0,l.jsx)("label",{htmlFor:"notifications",className:"text-sm text-gray-700",children:"接收通知"})]}),(0,l.jsx)("button",{onClick:g,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"保存更改"})]}):(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"姓名:"})," ",s.name]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"邮箱:"})," ",s.email]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"语言:"})," ","zh"===s.preferences.language?"中文":"English"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"所在城市:"})," ",s.preferences.location]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"通知:"})," ",s.preferences.notifications?"开启":"关闭"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"当地天气"}),(0,l.jsx)(v,{city:s.preferences.location})]})]})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"收藏的景点"}),(0,l.jsx)("div",{className:"space-y-2",children:s.favoriteAttractions.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded",children:[(0,l.jsx)("span",{children:e}),(0,l.jsx)("button",{className:"text-red-600 hover:text-red-800",children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"访问历史"}),(0,l.jsx)("div",{className:"space-y-2",children:s.visitHistory.map((e,t)=>(0,l.jsx)("div",{className:"py-2 px-3 bg-gray-50 rounded",children:(0,l.jsx)("span",{children:e})},t))})]})]}),(0,l.jsx)(w,{})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-gray-600",children:"无法加载用户信息"})})}},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[605,971,117,744],function(){return e(e.s=617)}),_N_E=e.O()}]);